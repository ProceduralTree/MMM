<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-08-14 Do 12:57 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fv</title>
<meta name="author" content="Jonathan Ulmer" />
<meta name="generator" content="Org Mode" />
<style type='text/css'>
<!--/*--><![CDATA[/*><!--*/
/* nice-org-html.css
;;==============================================================================
;; Copyright (C) 2024, Ewan Townshend

;; Author: Ewan Townshend
;; URL: https://github.com/ewantown/nice-org-html
;; Version: 1.2

;;==============================================================================
;; This program is free software; you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation, either version 3 of the License, or
;; (at your option) any later version.

;; This program is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.

;; You should have received a copy of the GNU General Public License
;; along with this program.  If not, see <https://www.gnu.org/licenses/>.

;; This file is not part of emacs.

;;==============================================================================
*/

/* basic layout ***************************************************************/
*,
*::before,
*::after {
    box-sizing: border-box;
}
html {
    font-family: Sans;
    line-height: 1.3;
    font-size: calc(15px + 0.390625vw);
    -webkit-text-size-adjust: 100%;
}

body {
    background: #999; /* overwritten with theme --bg */
    width: 100%;
    min-height: 100vh;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-family:
	-apple-system,
	BlinkMacSystemFont,
	segoe ui,
	Roboto,
	Oxygen,
	Ubuntu,
	Cantarell,
	open sans,
	helvetica neue,
	sans-serif,
	system-ui
}

#preamble,
#postamble {
    width: 100%;
}

#content {
    width: 80%;
    max-width: 80ch;
    margin-left: 1rem;
    margin-right: 1rem;
    flex: 1;
}

/* custom facing **************************************************************/
/* The variable values are injected by CSS pre-processing in et-org-html.el */
:root {
    --bc-tb: #282a2e;
    --bc-block: #c5c8c6;
    --clr: #282a2e;
    --clr-tb-hd: #282a2e;
    --clr-code: #282a2e;
    --bg: #ffffff;
    --bg-code: #cecece;
    --bg-tb-hd: #cecece;
    --bg-block: #f3f3f3;
    --clr-link: #969896;
    --clr-title: #282a2e;
    --clr-todo: #969896;
    --bg-todo: initial;
    --clr-done: #c5c8c6;
    --bg-done: initial;
    --ts-clr: #282a2e;
    --mg: 20px;
    --w-toc: 300px;
    --bg-keyword: initial;
    --clr-keyword: #282a2e;
    --bg-constant: initial;
    --clr-constant: #969896;
    --bg-comment: initial;
    --clr-comment: #c5c8c6;
    --bg-comment-delimiter: initial;
    --clr-comment-delimiter: initial;
    --bg-function: initial;
    --clr-function: #282a2e;
    --bg-variable: initial;
    --clr-variable: #969896;
    --bg-preprocessor: initial;
    --clr-preprocessor: #282a2e;
    --bg-doc: initial;
    --clr-doc: #c5c8c6;
    --bg-builtin: initial;
    --clr-builtin: #969896;
    --bg-string: initial;
    --clr-string: #969896;
    --clr-note: #0969da;
    --clr-tip: #1a7f37;
    --clr-important: #8250df;
    --clr-warning: #9a6700;
    --clr-caution: #cf222e;
}

body[data-mode='light'] {
    background: var(--bg);
    color: var(--clr);
}

body[data-mode='dark'] {
    background: var(--bg);
    color: var(--clr);
    --bc-tb: #c5c8c6;
    --bc-block: #717171;
    --clr: #c5c8c6;
    --clr-code: #ffffff;
    --clr-tb-hd: #ffffff;
    --bg: #1d1f21;
    --bg-tb-hd: #0f1011;
    --bg-code: #0f1011;
    --bg-block: #292b2b;
    --clr-link: #de935f;
    --clr-title: #c5c8c6;
    --clr-todo: #b5bd68;
    --bg-todo: initial;
    --clr-done: #5a5b5a;
    --bg-done: initial;
    --ts-clr: #b294bb;
    --mg: 20px;
    --w-toc: 300px;
    --bg-keyword: initial;
    --clr-keyword: #b294bb;
    --bg-constant: initial;
    --clr-constant: #de935f;
    --bg-comment: initial;
    --clr-comment: #5a5b5a;
    --bg-comment-delimiter: initial;
    --clr-comment-delimiter: initial;
    --bg-function: initial;
    --clr-function: #81a2be;
    --bg-variable: initial;
    --clr-variable: #cc6666;
    --bg-preprocessor: initial;
    --clr-preprocessor: #c5c8c6;
    --bg-doc: initial;
    --clr-doc: #717171;
    --bg-builtin: initial;
    --clr-builtin: #81a2be;
    --bg-string: initial;
    --clr-string: #b5bd68;
    --clr-note: #0969da;
    --clr-tip: #1a7f37;
    --clr-important: #8250df;
    --clr-warning: #9a6700;
    --clr-caution: #cf222e;
}

/* exceptions for badly rendering themes **************************************/
body[data-theme='leuven'],
body[data-theme='leuven-dark'] {
    --bg-code: var(--bg-block);
}

/* ootb page layout ***********************************************************/
#view-controls {
    position: sticky;
    display: flex;
    align-items: center;
    justify-content: center;
    top: 0;
    left: 0;
    width: 100%;
    background: var(--bg);
    color: var(--clr-code);
    height: 2.5rem;
    padding-top: 1.25rem;
    padding-bottom: 1.25rem;
    z-index: 100;
    border-radius: 5px; /* Rounded corners */
}
#toggle-mode {
    position: absolute;
    right: 5%;
    display: block;
    text-align: center;
    font-size: 1.5rem;
    background: var(--bg);
    color: var(--clr-code);
    padding: 0.25rem 0;
}
#goto-top {
    display: none;
}
#goto-top[data-show="true"] {
    position: relative;
    display: block;
    text-align: center;
    font-size: 1rem;
    background: var(--bg);
    color: var(--clr-code);
    padding: 0.25rem 0;
}
#toggle-toc {
    display: none;
}
#toggle-toc[data-show="true"] {
    position: absolute;
    left: 5%;
    display: block;
    text-align: center;
    font-size: 1.5rem;
    background: var(--bg);
    color: var(--clr-code);
    padding: 0.25rem 0;
}

#toggle-toc:hover,
#goto-top:hover,
#toggle-mode:hover {
    cursor: pointer;
}

#table-of-contents {
    display: none;
}
#table-of-contents[data-show="true"] {
    width: 80%;
    max-width: 80rem;
    margin-left: 1rem;
    margin-right: 1rem;
    background: var(--bg);
    scrollbar-width: none;
    -ms-overflow-style: none;
}

#table-of-contents::-webkit-scrollbar {
    display: none;
}

body[data-toc="true"] #content * {
    display: none;
}
body[data-toc="true"] #content #table-of-contents,
body[data-toc="true"] #content #table-of-contents * {
    display: block;
}


/* misc elements **************************************************************/

hr {
    height: 0;
    color: inherit;
}

b,
strong {
    font-weight: bolder;
}

code,
kbd,
samp,
pre {
    font-family:
	Menlo,
	ui-monospace,
	SFMono-Regular,
	Consolas,
	'Liberation Mono',
	monospace;
}

small {
    font-size: 80%;
}

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sub {
    bottom: -0.25em;
}

sup {
    top: -0.5em;
}

table {
    text-indent: 0;
    border-color: inherit;
}

summary {
    display: list-item;
}

h1 {
    color: var(--clr-title);
    text-align: center;
}
h2 {
    margin-top: 2rem;
    margin-bottom: 1rem;
}

code {
    color: var(--clr-code);
    background: var(--bg-code);
    border-radius: 2px;
    padding-left: 5px;
    padding-right: 5px;
}

pre::-webkit-scrollbar {
    display: none;
}

.todo {
    color: var(--clr-todo);
    background: var(--bg-todo);
}

.done {
    color: var(--clr-done);
    background: var(--bg-done);
}

.timestamp-wrapper {
    font-size: 0.8rem;
    color: var(--clr-ts);
}

table {
    width: 100%;
    border: 2px solid var(--bc-tb);
}

thead {
    color: var(--clr-tb-hd);
    background: var(--bg-tb-hd);
}

td, th {
    border: thin solid var(--bc-tb);
}

li {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
}
#text-table-of-contents li a:before {
    content: "â€¢ "
}

a {
    text-decoration: none;
    color: var(--clr-link);
}

a:hover {
    text-decoration: underline;
}

.MathJax_Display {
    font-size: 1.25em;
}

img {
    max-width: 100%;
}

pre {
    padding: 1rem;
    border: 1px solid var(--bc-block);
    border-radius: 0.5rem;
    background: var(--bg-block);
    font-size: 0.9rem;
    overflow-x: auto;
    -ms-overflow-style: none;
    scrollbar-width: thin;
}

.org-src-wrapper {
    position: relative;
    border: 1px solid var(--bc-block);
    border-radius: 0.5rem;
    background: var(--bg-code);
}

.org-src-bar {
    position: relative;
    top: 0rem;
    width: 100%;
    background: var(--bg-code);
    border-radius: 0.5rem;
    text-align: right;
    min-height: 1rem;
}

.org-src-wrapper .org-src-container {
    position: relative;
    border: none;
    border-radius: 0.5rem;
    background: var(--bg-code);
    z-index: 0;
}

.org-src-wrapper .org-src-container pre.src {
    border: none !important;
    background: var(--bg-code) !important;
    padding-top: 0rem;
    padding-bottom: 0rem;
    margin-top: 0rem;
    margin-bottom: 0rem;
    padding-bottom: 1.6rem;
}

.org-src-wrapper .org-src-bar .srcLangLabel {
    top: 0rem;
    right: 1.6rem;
    background-color: transparent;
    color: var(--clr-doc);
    border: none;
    padding: 0.5rem;
    padding-bottom: 0.3rem;
    text-align: center;
    text-decoration: none;
    font-size: 0.8rem;
    opacity: 0.5;
    z-index: 1;
    display: none;
}

.org-src-wrapper .org-src-bar .copyBtn {
    top: 0rem;
    right: 0.1rem;
    background-color: transparent;
    color: var(--clr-doc);
    border: none;
    padding: 0.5rem;
    padding-right: 0.7rem;
    padding-bottom: 0.3rem;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 0.8rem;
    cursor: pointer;
    opacity: 0.5;
    z-index: 1;
    transition: opacity 0.3s;
}

.org-src-wrapper .copyBtn:hover {
    opacity: 1;
}

.org-src-wrapper .copyBtn i {
    margin-right: 0.5rem;
    padding: 0.5rem;
}

.admonition {
    margin: 0.2rem;
    color: inherit;
    border-left: .25rem solid;
}
.admonition-title {
    margin: 0 0 0.5rem 0.5rem;
    padding: 0.5rem 0 0 0;
    display: flex;
    align-items: center;
}
.admonition-content > p {
    margin: 0.5rem 0 0 0.5rem;
    padding: 0 0 0.5rem 0;
}

.admonition.note {
    border-left-color: var(--clr-note);
}
.admonition-title.note {
    color: var(--clr-note);
}
.admonition-title.note:before {
    content: '';
    display: inline-block;
    margin-right: 0.5rem;
    width: 1rem;
    height: 1rem;
    background-color: var(--clr-note);
    mask-size: cover;    
    mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="false"><path class="admonition-icon-note" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>');    
}
.admonition-icon-note {
    fill: var(--clr-note);
}

.admonition.tip {
    border-left-color: var(--clr-tip);
}
.admonition-title.tip {
    color: var(--clr-tip);
}
.admonition-title.tip:before {
    content: '';
    fill: var(--clr-tip);    
    display: inline-block;
    margin-right: 0.5rem;
    width: 1rem;
    height: 1rem;
    background-color: var(--clr-tip);
    mask-size: cover;
    mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="false"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>');    
}

.admonition.important {
    border-left-color: var(--clr-important);
}
.admonition-title.important {
    color: var(--clr-important);
}
.admonition-title.important:before {
    content: '';
    fill: var(--clr-important);    
    display: inline-block;
    margin-right: 0.5rem;
    width: 1rem;
    height: 1rem;
    background-color: var(--clr-important);
    mask-size: cover;
    mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="false"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>');    
}

.admonition.warning {
    border-left-color: var(--clr-warning);
}
.admonition-title.warning {
    color: var(--clr-warning);
}
.admonition-title.warning:before {
    content: '';
    color: var(--clr-warning);    
    display: inline-block;
    margin-right: 0.5rem;
    width: 1rem;
    height: 1rem;
    background-color: var(--clr-warning);
    mask-size: cover;
    mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="false"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>');
}


.admonition.caution {
    border-left-color: var(--clr-caution);
}
.admonition-title.caution {
    color: var(--clr-caution);
}
.admonition-title.caution:before {
    content: '';
    fill: var(--clr-caution);    
    display: inline-block;
    margin-right: 0.5rem;
    width: 1rem;
    height: 1rem;
    background-color: var(--clr-caution);
    mask-size: cover;
    mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="false"><path d="M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>');    
}
/* responsive layouts *********************************************************/

@media only screen and (max-width: 768px) {
    #toggle-toc[data-show='true'] {
	padding-right: 5%;
    }
    #toggle-mode {
	padding-left: 5%;
    }
    #content {
	width: 90%;
    }
}

@media only screen and (max-width: 480px) {
    #view-controls {
	padding-top: 1.5em;
	padding-bottom: 1.5em;
    }
    #toggle-toc[data-show='true'] {
	padding-right: 5%;
    }
    #toggle-mode {
	padding-left: 5%;
    }
    #content {
	width: 90%;
    }
}


/* generated header and footer ************************************************/

#generated-header,
#generated-footer {
    width: 90%;
    margin-left: 5%;
    margin-right: 5%;
    line-height: 1;
}
.generated header {
    top: 0;
    left: 0;
}
.generated footer {
    bottom: 0;
    left: 0;
}
.generated header a,
.generated footer a {
    display: inline;
    color: var(--clr-title);
    text-decoration: none;
    transition: color .15s ease-in;
}
.generated header a:hover,
.generated footer a:hover {
    color: var(--clr-link);
}

.generated header nav {
    position: relative;
    margin-top: 1rem;
    top: 0;
    left: 0;
}
.generated footer nav {
    position: relative;
    bottom: 0;
    left: 0;
}

.generated .separator {
    display: block;
    width: 111%;
    margin-left: -5.5%;
    max-width: 100vw;
    height: 0.125rem;
    background: var(--bg-code);
}

.generated a .nav-title,
.generated a .nav-author {
    display: inline;
    margin-top: 1rem;
    margin-bottom: 1rem;
    padding-right: 10rem;
}

.generated .nav-title {
    letter-spacing: .075rem;
    font-weight: 500;
}

.generated .nav-toggle {
    display: none;
}
.generated .nav-button {
    display: none;
}
.generated .nav-list {
    overflow-y: hidden;
    display: block;
    float: right;
    list-style: none;
    margin-bottom: 0;
    margin-top: 0;
}

.generated .nav-item {
    position: relative;
    float: left;
    margin: 0;
}
.generated .nav-link {
    position: relative;
    float: right;
    margin-left: 2rem;
    margin-right: 0rem;
}

.generated .nav-toggle {
    max-height: 0;
    visibility: hidden;
    overflow-y: hidden;
}

.generated header .separator {
    margin-top: 1rem;
    margin-bottom: 0;
}

.generated footer .separator {
    margin-bottom: 1rem;
    margin-top: 0;
}

.generated .menu-sep {
    display: none;
    max-height: 0;
    overflow-y: hidden;
    transition: max-height 0.2s ease;
}

.generated footer {
    padding-bottom: 1rem;
}

.generated.compact footer {
    padding-bottom: 0;
}

.generated.compact header .separator {
    margin-top: 0;
    margin-bottom:0;
}
.generated.compact footer .separator {
    margin-bottom: 1rem;
}

.generated.compact .nav-toggle {
    visibility: visible;
}

.generated.compact .nav-toggle + label span::before {
    transition: all 0.2s ease-in;
}
.generated.compact .nav-toggle:checked + label span::before {
    transform: translateX(0.04rem) translateY(-0.25rem) rotate(90deg);
    transition: all 0.2s ease;
}

.generated.compact .menu-sep {
    display: flex;
    max-height: 0rem;
}
.generated.compact .nav-toggle:checked + label + .menu-sep {
    display: block;
    position: relative;
    max-height: 1rem;
    transition: max-height 0.2s ease;
}

.generated.compact .nav-list {
    float: none !important;
    position: relative;
    display: block;
    padding-left: 0;
    padding-right: 0;
    z-index: 5;
    width: 100%;
    height: auto;
    max-height: 0;
    margin: 0;
    overflow-x: hidden;
    overflow-y: hidden;
    transition: max-height 0.2s ease;
}
.generated.compact .nav-toggle:checked + label ~ .nav-list {
    display: block;
    max-height: 100rem;
    overflow-y: hidden;
}
.generated.compact header .nav-toggle:checked + label ~ .nav-list {
    transition: max-height 0.2s ease;
}

.generated.compact .nav-button {
    display: inline;
    position: relative;
    float: right;
    font-size: 1rem;
}
.generated.compact .nav-button span::before {
    display: inline-block;
    content: '\2807';
    font-size: 2rem;
    transform: translateX(0.25rem) translateY(-0.5rem);
}

.generated.compact .nav-item {
    float: none !important;
    text-align: center !important;
}
.generated.compact .nav-link {
    line-height: 2rem;
    margin-left: 2rem;
    margin-right: 2rem;
    float: none !important;
}

.generated.compact footer .separator.menu-sep {
    margin-bottom: -1rem;
}

.hidden {
    display: none;
}

.collapsible:hover {
    cursor: pointer;
}

.collapsible.collapsed::after {
    display: inline-block;
    content: '...';
}
/*]]>*/-->
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="preamble" class="status">
<div id='view-controls'><div id='toggle-mode' title='Mode'>&#9788;</div><div id='goto-top' title='Top'>&#8963;</div><div id='toggle-toc' title='Contents'>&#9776;</div></div>
</div>
<div id="content" class="content">
<h1 class="title">Fv</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org173a88b">1. Standard Diffusion equation</a>
<ul>
<li><a href="#org7d865f6">1.1. Derivation of the 1D Finite Volume Method</a></li>
<li><a href="#org62f0f93">1.2. Example diffusion terms</a>
<ul>
<li><a href="#orga89bd4d">1.2.1. 1D</a></li>
<li><a href="#orgef2b8ac">1.2.2. 2D Box Condition</a></li>
<li><a href="#org8179c51">1.2.3. 2D Oscillation</a></li>
<li><a href="#orgadddc7b">1.2.4. 1D Noise</a></li>
<li><a href="#orgf194cb1">1.2.5. Noise 2D</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org73b2202">2. Finite Volume 1D</a>
<ul>
<li><a href="#orgb993933">2.1. Program Structure</a></li>
</ul>
</li>
<li><a href="#org4e7a723">3. Multiscale</a></li>
<li><a href="#org5763f64">4. Cleanup</a></li>
<li><a href="#orgd8df3e8">5. 2D</a>
<ul>
<li><a href="#org9c8faaf">5.1. Numerical Flux in 2D</a></li>
</ul>
</li>
<li><a href="#org726fc78">6. 2D Multiscale</a></li>
<li><a href="#org255a6ec">7. Reference Solution</a></li>
</ul>
</div>
</div>
<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_b7136f0ab384446e9508d4b0d9b4dbc4>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_b7136f0ab384446e9508d4b0d9b4dbc4=document.querySelector('button[name=btn_b7136f0ab384446e9508d4b0d9b4dbc4]');
copyBtnbtn_b7136f0ab384446e9508d4b0d9b4dbc4.addEventListener('click', function(event) {
let res = copyTextToClipboard(`import numpy as np\n`);copyBtnbtn_b7136f0ab384446e9508d4b0d9b4dbc4.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_b7136f0ab384446e9508d4b0d9b4dbc4.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> numpy <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">as</span> np
</code></pre>
</div></div>
<div id="outline-container-org173a88b" class="outline-2">
<h2 id="org173a88b"><span class="section-number-2">1.</span> Standard Diffusion equation</h2>
<div class="outline-text-2" id="text-1">
\begin{align*}
\nabla \cdot (D(x) \nabla c) &= f(x) & \text{in}& \, \Omega \\
c(x) &= 0 &  \text{on}& \, \partial \Omega
\end{align*}
</div>
<div id="outline-container-org7d865f6" class="outline-3">
<h3 id="org7d865f6"><span class="section-number-3">1.1.</span> Derivation of the 1D Finite Volume Method</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The Finite Volume method considers the differential equation in Integral form over disjunct (\(Q_i \cap Q_j = \emptyset , i\neq  j\)) reference cells \(Q_{i}\), \(\bigcup_{i=1}^N  Q_{i} = \Omega \) and calculates the integral over them, with an integral over the reference cell boundaries using Stokes integration.
</p>
\begin{align}
\label{eq:fv-integral}
\int_{Q_i} \nabla \cdot (D(x) \nabla c )  &= \int_{Q_i} f(x) \, \mathrm{d}x  & i&=1, \dots  , N\\
\int_{\partial Q_i} D(x) \nabla c \cdot \vec{n} \, \mathrm{d}S \, &=   \int_{Q_i} f(x) \, \mathrm{d} x & i&=1, \dots  , N
\end{align}
<p>
The Finite Volume Method then considers the solution piecewise constant on \(Q\). This creates discontinuities on the cell boundaries, where the values are not uniquely defined.
The Finite Volume method therefore introduces a numerical flux in the Ansatz and solves the integral over the flux instead.
since the assumed solution is constant we approximation the source term \(f(\vec{x})\)  with its value on the cell center \(x_i\) of \(Q_i\) and calculate the integrals directly.
</p>
\begin{align}
\label{eq:fv-integral}
\int_{\partial Q_i} g(c^+, c^-) \cdot \vec{n} \, \mathrm{d}S \, &=   \int_{Q_i} f(x) \, \mathrm{d} x & i&=1, \dots  , N\\
 \int_{\partial Q_i} g(c^+, c^-) \cdot \vec{n} \, \mathrm{d}S \,&=   |Q_i| f(x_i)  & i&=1, \dots  , N
\end{align}
</div>
</div>
<div id="outline-container-org62f0f93" class="outline-3">
<h3 id="org62f0f93"><span class="section-number-3">1.2.</span> Example diffusion terms</h3>
<div class="outline-text-3" id="text-1-2">
<p>
We investigate of single and multiscale solvers with different Diffusion functions, that we introduce in the followin sections
</p>
</div>
<div id="outline-container-orga89bd4d" class="outline-4">
<h4 id="orga89bd4d"><span class="section-number-4">1.2.1.</span> 1D</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
Since the Aim of multiscale Finite Volume, is to improve the results for highly fluctuating diffusivities, we test with the following oscillating function
</p>
\begin{align*}
D(x) &= \frac{1}{2+ 1.9 \cos \left( \frac{2 \pi x}{\epsilon} \right)}
\end{align*}
<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_7b94b0bcfd154ce2a7d3aaa634b974af>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_7b94b0bcfd154ce2a7d3aaa634b974af=document.querySelector('button[name=btn_7b94b0bcfd154ce2a7d3aaa634b974af]');
copyBtnbtn_7b94b0bcfd154ce2a7d3aaa634b974af.addEventListener('click', function(event) {
let res = copyTextToClipboard(`def oscillation(x, eps = 0.1):\n    return 1 / (2+1.9 * np.cos(2 * np.pi* x / eps))\n`);copyBtnbtn_7b94b0bcfd154ce2a7d3aaa634b974af.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_7b94b0bcfd154ce2a7d3aaa634b974af.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">oscillation</span>(x, eps = 0.1):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">return</span> 1 / (2+1.9 * np.cos(2 * np.pi* x / eps))
</code></pre>
</div></div>


<div id="orgdec44b6" class="figure">
<p><img src="images/D.png" alt="D.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Oscillating Diffusivity for 1D finite volume method</p>
</div>
</div>
</div>
<div id="outline-container-orgef2b8ac" class="outline-4">
<h4 id="orgef2b8ac"><span class="section-number-4">1.2.2.</span> 2D Box Condition</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
To test numerical stability of our methods we introduce a box constrain condition, that traps some concentration in the center.
</p>
<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_b4053a8f64cc47e9848877c4de76f089>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_b4053a8f64cc47e9848877c4de76f089=document.querySelector('button[name=btn_b4053a8f64cc47e9848877c4de76f089]');
copyBtnbtn_b4053a8f64cc47e9848877c4de76f089.addEventListener('click', function(event) {
let res = copyTextToClipboard(`alpha = 1.\ngamma = 0.002\n\nexp_kernel = lambda r: alpha * np.exp( - r / gamma)\n\ndef R(x,y , p=2):\n    center = np.array([0.5,0.5])\n    r = 0.2\n    thicc = 0.03\n    return np.maximum(0. , np.abs((np.abs(x -center[0])**p + np.abs(y - center[1])**p)**(1/p) - r) - thicc)\n\ndef box(x,y , p=2):\n    return np.maximum(0.0005 , 1. -  exp_kernel(R(x,y , p=100)))\ndef circle(x,y , p=2):\n    return np.maximum(0.0005 , 1. -  exp_kernel(R(x,y , p=2)))\ndef rhombus(x,y , p=2):\n    return np.maximum(0.0005 , 1. -  exp_kernel(R(x,y , p=1)))\n`);copyBtnbtn_b4053a8f64cc47e9848877c4de76f089.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_b4053a8f64cc47e9848877c4de76f089.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-variable); background-color: var(--bg-variable);">alpha</span> = 1.
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">gamma</span> = 0.002

<span style="color: var(--clr-variable); background-color: var(--bg-variable);">exp_kernel</span> = <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">lambda</span> r: alpha * np.exp( - r / gamma)

<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">R</span>(x,y , p=2):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">center</span> = np.array([0.5,0.5])
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">r</span> = 0.2
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">thicc</span> = 0.03
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">return</span> np.maximum(0. , np.<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">abs</span>((np.<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">abs</span>(x -center[0])**p + np.<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">abs</span>(y - center[1])**p)**(1/p) - r) - thicc)
 
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">box</span>(x,y , p=2):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">return</span> np.maximum(0.0005 , 1. -  exp_kernel(R(x,y , p=100)))
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">circle</span>(x,y , p=2):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">return</span> np.maximum(0.0005 , 1. -  exp_kernel(R(x,y , p=2)))
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">rhombus</span>(x,y , p=2):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">return</span> np.maximum(0.0005 , 1. -  exp_kernel(R(x,y , p=1)))
</code></pre>
</div></div>


<div id="org9af040f" class="figure">
<p><img src="images/box-constraints.png" alt="box-constraints.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Constraints restricting flow from the center of the Domain</p>
</div>
</div>
</div>
<div id="outline-container-org8179c51" class="outline-4">
<h4 id="org8179c51"><span class="section-number-4">1.2.3.</span> 2D Oscillation</h4>
<div class="outline-text-4" id="text-1-2-3">
<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_a7ab9c5106d14332bbdbc54a55e99e6b>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_a7ab9c5106d14332bbdbc54a55e99e6b=document.querySelector('button[name=btn_a7ab9c5106d14332bbdbc54a55e99e6b]');
copyBtnbtn_a7ab9c5106d14332bbdbc54a55e99e6b.addEventListener('click', function(event) {
let res = copyTextToClipboard(`def osc2D_point(x,y , eps = 0.25):\n    return oscillation(x, eps=eps) * oscillation(y, eps=eps)\ndef osc2D_line(x,y , eps = 0.25):\n    return oscillation(x, eps=eps) + oscillation(y, eps=eps)\n\n`);copyBtnbtn_a7ab9c5106d14332bbdbc54a55e99e6b.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_a7ab9c5106d14332bbdbc54a55e99e6b.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">osc2D_point</span>(x,y , eps = 0.25):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">return</span> oscillation(x, eps=eps) * oscillation(y, eps=eps)
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">osc2D_line</span>(x,y , eps = 0.25):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">return</span> oscillation(x, eps=eps) + oscillation(y, eps=eps)

</code></pre>
</div></div>
<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_1fdbd9ff4e254af59c8a38284e81e370>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_1fdbd9ff4e254af59c8a38284e81e370=document.querySelector('button[name=btn_1fdbd9ff4e254af59c8a38284e81e370]');
copyBtnbtn_1fdbd9ff4e254af59c8a38284e81e370.addEventListener('click', function(event) {
let res = copyTextToClipboard(`import src.diffusion as D\nreload(D)\n\n\nN = 1000\nM = 1000\nx = np.linspace(0.,1., N)\ny= np.linspace(0.,1., M)\ngrid = np.meshgrid(x,y)\ndiffusion_b = D.osc2D_point(grid[0] , grid[1])\ndiffusion_b = diffusion_b.reshape((N,M))\ndiffusion_c = D.osc2D_line(grid[0] , grid[1])\ndiffusion_c = diffusion_c.reshape((N,M))\n\nfig,axis= plt.subplots(1,2)\nim1 = axis[0].imshow(diffusion_b , cmap=\"magma\" , extent=[0,1,0,1])\naxis[0].set_title(r\"0D Obstacles\")\nim2 = axis[1].imshow(diffusion_c , cmap=\"magma\" , extent=[0,1,0,1])\naxis[1].set_title(r\"1D Obstacles\")\n\n#fig.colorbar()\nfig.suptitle(r\"Osscillating Diffusion\")\nfig.colorbar(im1 ,ax=axis , fraction=0.025)\n`);copyBtnbtn_1fdbd9ff4e254af59c8a38284e81e370.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_1fdbd9ff4e254af59c8a38284e81e370.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python" id="org5e99962"><code><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> src.diffusion <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">as</span> D
<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">reload</span>(D)


<span style="color: var(--clr-variable); background-color: var(--bg-variable);">N</span> = 1000
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">M</span> = 1000
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">x</span> = np.linspace(0.,1., N)
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">y</span>= np.linspace(0.,1., M)
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">grid</span> = np.meshgrid(x,y)
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">diffusion_b</span> = D.osc2D_point(grid[0] , grid[1])
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">diffusion_b</span> = diffusion_b.reshape((N,M))
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">diffusion_c</span> = D.osc2D_line(grid[0] , grid[1])
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">diffusion_c</span> = diffusion_c.reshape((N,M))

<span style="color: var(--clr-variable); background-color: var(--bg-variable);">fig</span>,<span style="color: var(--clr-variable); background-color: var(--bg-variable);">axis</span>= plt.subplots(1,2)
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">im1</span> = axis[0].imshow(diffusion_b , cmap=<span style="color: var(--clr-string); background-color: var(--bg-string);">"magma"</span> , extent=[0,1,0,1])
axis[0].set_title(r<span style="color: var(--clr-string); background-color: var(--bg-string);">"0D Obstacles"</span>)
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">im2</span> = axis[1].imshow(diffusion_c , cmap=<span style="color: var(--clr-string); background-color: var(--bg-string);">"magma"</span> , extent=[0,1,0,1])
axis[1].set_title(r<span style="color: var(--clr-string); background-color: var(--bg-string);">"1D Obstacles"</span>)

<span style="color: var(--clr-comment-delimiter); background-color: var(--bg-comment-delimiter);">#</span><span style="color: var(--clr-comment); background-color: var(--bg-comment);">fig.colorbar()</span>
fig.suptitle(r<span style="color: var(--clr-string); background-color: var(--bg-string);">"Osscillating Diffusion"</span>)
fig.colorbar(im1 ,ax=axis , fraction=0.025)
</code></pre>
</div></div>


<div id="org6cbb6a3" class="figure">
<p><img src="images/oscillation-2d.png" alt="oscillation-2d.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-orgadddc7b" class="outline-4">
<h4 id="orgadddc7b"><span class="section-number-4">1.2.4.</span> 1D Noise</h4>
<div class="outline-text-4" id="text-1-2-4">
<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_3a5d82f02ccb4886b7c9cc52ad68210d>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_3a5d82f02ccb4886b7c9cc52ad68210d=document.querySelector('button[name=btn_3a5d82f02ccb4886b7c9cc52ad68210d]');
copyBtnbtn_3a5d82f02ccb4886b7c9cc52ad68210d.addEventListener('click', function(event) {
let res = copyTextToClipboard(`def noise1D(x,scale=10.  , frequencies=5):\n    s = lambda x ,f , a , o: a* np.sin(f*2*np.pi*(x + o))\n    coeffs = np.random.rand(frequencies,3)\n    res = np.zeros(len(x))\n    for i in range(frequencies):\n        res += s(x, scale *coeffs[i,0] ,coeffs[i,1] , coeffs[i,2] )\n    res = res / (2*np.sum(coeffs[:,1])) + 0.5\n    return res\n`);copyBtnbtn_3a5d82f02ccb4886b7c9cc52ad68210d.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_3a5d82f02ccb4886b7c9cc52ad68210d.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">noise1D</span>(x,scale=10.  , frequencies=5):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">s</span> = <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">lambda</span> x ,f , a , o: a* np.sin(f*2*np.pi*(x + o))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">coeffs</span> = np.random.rand(frequencies,3)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">res</span> = np.zeros(<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">len</span>(x))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">for</span> i <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">in</span> <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">range</span>(frequencies):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">res</span> += s(x, scale *coeffs[i,0] ,coeffs[i,1] , coeffs[i,2] )
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">res</span> = res / (2*np.<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">sum</span>(coeffs[:,1])) + 0.5
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">return</span> res
</code></pre>
</div></div>


<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_88d42e37644346d79d9e47bcea54d339>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_88d42e37644346d79d9e47bcea54d339=document.querySelector('button[name=btn_88d42e37644346d79d9e47bcea54d339]');
copyBtnbtn_88d42e37644346d79d9e47bcea54d339.addEventListener('click', function(event) {
let res = copyTextToClipboard(`import src.diffusion as D\nreload(D)\nx = np.linspace(0,1)\nplt.plot(D.noise1D(x))\n`);copyBtnbtn_88d42e37644346d79d9e47bcea54d339.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_88d42e37644346d79d9e47bcea54d339.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> src.diffusion <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">as</span> D
<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">reload</span>(D)
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">x</span> = np.linspace(0,1)
plt.plot(D.noise1D(x))
</code></pre>
</div></div>


<div id="org93eb3ae" class="figure">
<p><img src="images/noise.png" alt="noise.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-orgf194cb1" class="outline-4">
<h4 id="orgf194cb1"><span class="section-number-4">1.2.5.</span> Noise 2D</h4>
<div class="outline-text-4" id="text-1-2-5">
<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_1895ac5badfb45dbb3fbb6a0257a3c63>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_1895ac5badfb45dbb3fbb6a0257a3c63=document.querySelector('button[name=btn_1895ac5badfb45dbb3fbb6a0257a3c63]');
copyBtnbtn_1895ac5badfb45dbb3fbb6a0257a3c63.addEventListener('click', function(event) {
let res = copyTextToClipboard(`\n`);copyBtnbtn_1895ac5badfb45dbb3fbb6a0257a3c63.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_1895ac5badfb45dbb3fbb6a0257a3c63.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code>
</code></pre>
</div></div>


<div id="org599c3ab" class="figure">
<p><img src="images/noise-2D.png" alt="noise-2D.png" />
</p>
</div>

<p>
for example upwind
</p>

\begin{align*}
g(c^+ , c^-) = - D(x^{\frac{1}{2} +}) \frac{c^+ - c^-}{h}
\end{align*}

\begin{align*}
g(c^+ , c^-) &= T_{\pm } * \left( c^+ - c^- \right) \\
T_{\pm } &= - D(x^{\frac{1}{2}+}) \frac{1}{h}
\end{align*}


<p>
Linear System
</p>
\begin{align*}
\int_{\partial Q_{i}} D(x_{i}) \nabla c \cdot \vec{n}  \, \mathrm{d}S &= |Q| \overline{f}(x_{i}) \\
\sum_{j \in \left\{ -1,1 \right\} } j *  g(c_{i+j+1} , c_{i+j})  &=   h \overline{f}(x_{i})
\end{align*}
</div>
</div>
</div>
</div>
<div id="outline-container-org73b2202" class="outline-2">
<h2 id="org73b2202"><span class="section-number-2">2.</span> Finite Volume 1D</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgb993933" class="outline-3">
<h3 id="orgb993933"><span class="section-number-3">2.1.</span> Program Structure</h3>
<div class="outline-text-3" id="text-2-1">
<p>
For convenience in Explanation and Execution, we bundle all required information for solving a 1D system into a python class, which is structured as follows
</p>
<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_00a0d4d8ebd2475282634c44f9c31a67>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_00a0d4d8ebd2475282634c44f9c31a67=document.querySelector('button[name=btn_00a0d4d8ebd2475282634c44f9c31a67]');
copyBtnbtn_00a0d4d8ebd2475282634c44f9c31a67.addEventListener('click', function(event) {
let res = copyTextToClipboard(`class FVSolver:\n   N : int\n   h : np.float64\n   x : NDArray[np.float64]\n   D : Callable\n   f : NDArray[np.float64]\n   c : NDArray[np.float64]\n\n   _T : NDArray[np.float64]\n\n<<Init>>\n\n<<Assemble Matrix>>\n\n<<Boundary>>\n\n<<Solve>>\n\n<<Microscale Transmissions>>\n`);copyBtnbtn_00a0d4d8ebd2475282634c44f9c31a67.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_00a0d4d8ebd2475282634c44f9c31a67.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">class</span> <span style="color: #78DCE8;">FVSolver</span>:
<span style="color: #4a9d48074b31;"> </span>  N : <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">int</span>
<span style="color: #4a9d48074b31;"> </span>  h : np.float64
<span style="color: #4a9d48074b31;"> </span>  x : NDArray[np.float64]
<span style="color: #4a9d48074b31;"> </span>  D : Callable
<span style="color: #4a9d48074b31;"> </span>  f : NDArray[np.float64]
<span style="color: #4a9d48074b31;"> </span>  c : NDArray[np.float64]
 
<span style="color: #4a9d48074b31;"> </span>  _T : NDArray[np.float64]
 
&lt;&lt;Init&gt;&gt;

&lt;&lt;Assemble Matrix&gt;&gt;

&lt;&lt;Boundary&gt;&gt;

&lt;&lt;Solve&gt;&gt;

&lt;&lt;Microscale Transmissions&gt;&gt;
</code></pre>
</div></div>


<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_6734e7bea72e495a8fa4c59c9856cd60>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_6734e7bea72e495a8fa4c59c9856cd60=document.querySelector('button[name=btn_6734e7bea72e495a8fa4c59c9856cd60]');
copyBtnbtn_6734e7bea72e495a8fa4c59c9856cd60.addEventListener('click', function(event) {
let res = copyTextToClipboard(`   def __init__(self , N :int , D :Callable  , domain=(0.,1.))->None:\n       self.h = (domain[1] - domain[0]) / N\n       self.N = N\n       self.D = D\n       self.x = np.linspace(domain[0] , domain[1] , N)\n       self._T =  -1/self.h * D((self.x[:-1] + self.x[1:]) * 0.5)\n       self.f = self.h* np.ones(N)\n\n`);copyBtnbtn_6734e7bea72e495a8fa4c59c9856cd60.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_6734e7bea72e495a8fa4c59c9856cd60.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python" id="org8f5f1cb"><code><span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">__init__</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span> , N :<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">int</span> , D :Callable  , domain=(0.,1.))-&gt;<span style="color: var(--clr-constant); background-color: var(--bg-constant);">None</span>:
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">h</span> = (domain[1] - domain[0]) / N
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">N</span> = N
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">D</span> = D
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">x</span> = np.linspace(domain[0] , domain[1] , N)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">_T</span> =  -1/<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.h * D((<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.x[:-1] + <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.x[1:]) * 0.5)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">f</span> = <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.h* np.ones(N)

</code></pre>
</div></div>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_c499147828a74ae0a05ae71ebc78bf8c>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_c499147828a74ae0a05ae71ebc78bf8c=document.querySelector('button[name=btn_c499147828a74ae0a05ae71ebc78bf8c]');
copyBtnbtn_c499147828a74ae0a05ae71ebc78bf8c.addEventListener('click', function(event) {
let res = copyTextToClipboard(`   def solve(self):\n      self.c = spsolve(self._A.tocsr() , self.f)\n      return self.c\n\n`);copyBtnbtn_c499147828a74ae0a05ae71ebc78bf8c.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_c499147828a74ae0a05ae71ebc78bf8c.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python" id="orgdc787f2"><code><span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">solve</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">c</span> = spsolve(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._A.tocsr() , <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.f)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">return</span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.c

</code></pre>
</div></div>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_06458e9c7aea414086d4c942786b0977>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_06458e9c7aea414086d4c942786b0977=document.querySelector('button[name=btn_06458e9c7aea414086d4c942786b0977]');
copyBtnbtn_06458e9c7aea414086d4c942786b0977.addEventListener('click', function(event) {
let res = copyTextToClipboard(`   def set_boundary(self , bc=(0.,0.)):\n      self.f[0] = bc[0]\n      self.f[-1] = bc[1]\n\n`);copyBtnbtn_06458e9c7aea414086d4c942786b0977.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_06458e9c7aea414086d4c942786b0977.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python" id="org3ca75c2"><code><span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">set_boundary</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span> , bc=(0.,0.)):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">f</span>[0] = bc[0]
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">f</span>[-1] = bc[1]

</code></pre>
</div></div>





<p>
Matrix Assembly
</p>
<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_1cf2dc4bb5bb42d49e8684caa72fae16>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_1cf2dc4bb5bb42d49e8684caa72fae16=document.querySelector('button[name=btn_1cf2dc4bb5bb42d49e8684caa72fae16]');
copyBtnbtn_1cf2dc4bb5bb42d49e8684caa72fae16.addEventListener('click', function(event) {
let res = copyTextToClipboard(`   def assemble_matrix(self)-> None:\n      diagp1 = np.zeros(self.N)\n      diagp1[2:] =  self._T[1:]\n      diagm1 = np.zeros(self.N)\n      diagm1[:-2] =  self._T[:-1]\n      diag0 = np.ones(self.N)\n      diag0[1:-1] = -1 * (self._T[1:] + self._T[:-1])\n      self._A = spdiags([diagm1 , diag0 , diagp1] , np.array( [-1, 0, 1] ))\n`);copyBtnbtn_1cf2dc4bb5bb42d49e8684caa72fae16.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_1cf2dc4bb5bb42d49e8684caa72fae16.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python" id="orgf53f265"><code><span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">assemble_matrix</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>)-&gt; <span style="color: var(--clr-constant); background-color: var(--bg-constant);">None</span>:
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diagp1</span> = np.zeros(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diagp1</span>[2:] =  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T[1:]
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diagm1</span> = np.zeros(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diagm1</span>[:-2] =  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T[:-1]
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag0</span> = np.ones(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag0</span>[1:-1] = -1 * (<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T[1:] + <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T[:-1])
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">_A</span> = spdiags([diagm1 , diag0 , diagp1] , np.array( [-1, 0, 1] ))
</code></pre>
</div></div>
<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_ff2003a2b27c4a9d9961b9062799cf71>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_ff2003a2b27c4a9d9961b9062799cf71=document.querySelector('button[name=btn_ff2003a2b27c4a9d9961b9062799cf71]');
copyBtnbtn_ff2003a2b27c4a9d9961b9062799cf71.addEventListener('click', function(event) {
let res = copyTextToClipboard(`sns.heatmap(A.todense())\nplt.title(\"Sparsity Patter of A\")\n`);copyBtnbtn_ff2003a2b27c4a9d9961b9062799cf71.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_ff2003a2b27c4a9d9961b9062799cf71.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code>sns.heatmap(A.todense())
plt.title(<span style="color: var(--clr-string); background-color: var(--bg-string);">"Sparsity Patter of A"</span>)
</code></pre>
</div></div>


<div id="org6373c95" class="figure">
<p><img src="images/A-sparsity.svg" alt="A-sparsity.svg" class="org-svg" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org4e7a723" class="outline-2">
<h2 id="org4e7a723"><span class="section-number-2">3.</span> Multiscale</h2>
<div class="outline-text-2" id="text-3">
<p>
In 1D
</p>
<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_c7a6b2a83b994dbc98ceb1f5d20c3ffa>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_c7a6b2a83b994dbc98ceb1f5d20c3ffa=document.querySelector('button[name=btn_c7a6b2a83b994dbc98ceb1f5d20c3ffa]');
copyBtnbtn_c7a6b2a83b994dbc98ceb1f5d20c3ffa.addEventListener('click', function(event) {
let res = copyTextToClipboard(`   def set_multiscale_transmissions(self, resolution)->NDArray[np.float64]:\n      micro_basis = np.zeros((self.N -1)*resolution)\n      for i in range(self.N -1):\n         micro_fv = FVSolver(resolution , self.D , domain=(self.x[i] , self.x[i+1]))\n         micro_fv.set_boundary(bc=(0.,1.))\n         micro_fv.assemble_matrix()\n         phi = micro_fv.solve()\n\n         micro_basis[resolution * i:resolution*(i+1)] = phi\n         hm = micro_fv.h\n         self._T[i] = -hm * np.sum(((phi[1:] - phi[:-1])/hm)**2 * self.D(micro_fv.x[:-1]))\n      return micro_basis\n`);copyBtnbtn_c7a6b2a83b994dbc98ceb1f5d20c3ffa.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_c7a6b2a83b994dbc98ceb1f5d20c3ffa.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python" id="org6eb8d0f"><code><span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">set_multiscale_transmissions</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>, resolution)-&gt;NDArray[np.float64]:
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-variable); background-color: var(--bg-variable);">micro_basis</span> = np.zeros((<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N -1)*resolution)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">for</span> i <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">in</span> <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">range</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N -1):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span><span style="color: var(--clr-variable); background-color: var(--bg-variable);">micro_fv</span> = FVSolver(resolution , <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.D , domain=(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.x[i] , <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.x[i+1]))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>micro_fv.set_boundary(bc=(0.,1.))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>micro_fv.assemble_matrix()
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span><span style="color: var(--clr-variable); background-color: var(--bg-variable);">phi</span> = micro_fv.solve()
         
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span><span style="color: var(--clr-variable); background-color: var(--bg-variable);">micro_basis</span>[resolution * i:resolution*(i+1)] = phi
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span><span style="color: var(--clr-variable); background-color: var(--bg-variable);">hm</span> = micro_fv.h
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">_T</span>[i] = -hm * np.<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">sum</span>(((phi[1:] - phi[:-1])/hm)**2 * <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.D(micro_fv.x[:-1]))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">return</span> micro_basis
</code></pre>
</div></div>

\begin{align*}
T_{\pm } &= -\int_{Q} D(x) (\phi'_{\pm} (x))^2\, \mathrm{d}x
\end{align*}


<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_84c79cb8571e4cc1baba514ca4e53817>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_84c79cb8571e4cc1baba514ca4e53817=document.querySelector('button[name=btn_84c79cb8571e4cc1baba514ca4e53817]');
copyBtnbtn_84c79cb8571e4cc1baba514ca4e53817.addEventListener('click', function(event) {
let res = copyTextToClipboard(`c_macro = sp.sparse.linalg.spsolve(A_macro.tocsr(),source)\nc_multi = np.zeros((N-1)* n)\nx = np.linspace(0,1,N)\nx_multi = np.linspace(0,1 , n*(N-1))\nfor i in range(len(c_macro)-1):\n    t = micro_basis[n*i:n*(i+1)]\n    c_multi[n*i:n*(i+1)] = (1-t) * c_macro[i] + t * c_macro[i+1]\nplt.plot(x,c)\nplt.plot(x,c_macro)\nplt.plot(x_multi,c_multi)\nplt.plot(x_fine , c_fine)\nplt.title(\"Comparison Of Different Solvers\")\nplt.xlabel(r\"$x$\")\nplt.ylabel(r\"$c(x)$\")\nplt.legend([\"macro\" , \"multiscale\", \"multi_fine\" , \"reference\"])\n`);copyBtnbtn_84c79cb8571e4cc1baba514ca4e53817.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_84c79cb8571e4cc1baba514ca4e53817.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-variable); background-color: var(--bg-variable);">c_macro</span> = sp.sparse.linalg.spsolve(A_macro.tocsr(),source)
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">c_multi</span> = np.zeros((N-1)* n)
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">x</span> = np.linspace(0,1,N)
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">x_multi</span> = np.linspace(0,1 , n*(N-1))
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">for</span> i <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">in</span> <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">range</span>(<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">len</span>(c_macro)-1):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">t</span> = micro_basis[n*i:n*(i+1)]
<span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">c_multi</span>[n*i:n*(i+1)] = (1-t) * c_macro[i] + t * c_macro[i+1]
plt.plot(x,c)
plt.plot(x,c_macro)
plt.plot(x_multi,c_multi)
plt.plot(x_fine , c_fine)
plt.title(<span style="color: var(--clr-string); background-color: var(--bg-string);">"Comparison Of Different Solvers"</span>)
plt.xlabel(r<span style="color: var(--clr-string); background-color: var(--bg-string);">"$x$"</span>)
plt.ylabel(r<span style="color: var(--clr-string); background-color: var(--bg-string);">"$c(x)$"</span>)
plt.legend([<span style="color: var(--clr-string); background-color: var(--bg-string);">"macro"</span> , <span style="color: var(--clr-string); background-color: var(--bg-string);">"multiscale"</span>, <span style="color: var(--clr-string); background-color: var(--bg-string);">"multi_fine"</span> , <span style="color: var(--clr-string); background-color: var(--bg-string);">"reference"</span>])
</code></pre>
</div></div>


<div id="orgee6829d" class="figure">
<p><img src="images/multiscaleplot.svg" alt="multiscaleplot.svg" class="org-svg" />
</p>
</div>
</div>
</div>
<div id="outline-container-org5763f64" class="outline-2">
<h2 id="org5763f64"><span class="section-number-2">4.</span> Cleanup</h2>
<div class="outline-text-2" id="text-4">
<pre class="example">
None
</pre>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_8df584b868d74e19b4e71c41886542e8>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_8df584b868d74e19b4e71c41886542e8=document.querySelector('button[name=btn_8df584b868d74e19b4e71c41886542e8]');
copyBtnbtn_8df584b868d74e19b4e71c41886542e8.addEventListener('click', function(event) {
let res = copyTextToClipboard(`from importlib import reload\nimport src.fvsolver\nfrom src.fvsolver import FVSolver\nreload(src.fvsolver)\nepsilon = 0.1\nD = lambda x: 1 / (2+1.9 * np.cos(2 * np.pi* x / epsilon))\nfv = FVSolver(10 ,  D)\nfv.assemble_matrix()\nfv.set_boundary()\nc_course = fv.solve()\nplt.plot(c_course)\n`);copyBtnbtn_8df584b868d74e19b4e71c41886542e8.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_8df584b868d74e19b4e71c41886542e8.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">from</span> importlib <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">reload</span>
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> src.fvsolver
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">from</span> src.fvsolver <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> FVSolver
<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">reload</span>(src.fvsolver)
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">epsilon</span> = 0.1
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">D</span> = <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">lambda</span> x: 1 / (2+1.9 * np.cos(2 * np.pi* x / epsilon))
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">fv</span> = FVSolver(10 ,  D)
fv.assemble_matrix()
fv.set_boundary()
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">c_course</span> = fv.solve()
plt.plot(c_course)
</code></pre>
</div></div>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_e30088d69ab745f8ac1138b737dc32d9>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_e30088d69ab745f8ac1138b737dc32d9=document.querySelector('button[name=btn_e30088d69ab745f8ac1138b737dc32d9]');
copyBtnbtn_e30088d69ab745f8ac1138b737dc32d9.addEventListener('click', function(event) {
let res = copyTextToClipboard(`mb = fv.set_multiscale_transmissions(100)\nplt.plot(mb)\n`);copyBtnbtn_e30088d69ab745f8ac1138b737dc32d9.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_e30088d69ab745f8ac1138b737dc32d9.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-variable); background-color: var(--bg-variable);">mb</span> = fv.set_multiscale_transmissions(100)
plt.plot(mb)
</code></pre>
</div></div>


<div id="org6104c35" class="figure">
<p><img src="images/msbasis.png" alt="msbasis.png" />
</p>
</div>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_ffe935e7781144b792d9b4070becfc4c>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_ffe935e7781144b792d9b4070becfc4c=document.querySelector('button[name=btn_ffe935e7781144b792d9b4070becfc4c]');
copyBtnbtn_ffe935e7781144b792d9b4070becfc4c.addEventListener('click', function(event) {
let res = copyTextToClipboard(`fv.assemble_matrix()\nc_multi = fv.solve()\nplt.plot(c_multi)\n`);copyBtnbtn_ffe935e7781144b792d9b4070becfc4c.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_ffe935e7781144b792d9b4070becfc4c.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code>fv.assemble_matrix()
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">c_multi</span> = fv.solve()
plt.plot(c_multi)
</code></pre>
</div></div>


<div id="org1466a0d" class="figure">
<p><img src="images/multi1D.png" alt="multi1D.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-orgd8df3e8" class="outline-2">
<h2 id="orgd8df3e8"><span class="section-number-2">5.</span> 2D</h2>
<div class="outline-text-2" id="text-5">
<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_6c42cf326eb642aaac67423d005cb397>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_6c42cf326eb642aaac67423d005cb397=document.querySelector('button[name=btn_6c42cf326eb642aaac67423d005cb397]');
copyBtnbtn_6c42cf326eb642aaac67423d005cb397.addEventListener('click', function(event) {
let res = copyTextToClipboard(`import scipy as sp\nimport numpy as np\nclass FVSolver2D:\n   N : int\n   M : int\n   h_x : np.float64\n   h_y : np.float64\n   x : NDArray[np.float64]\n   y : NDArray[np.float64]\n   D : Callable\n   f : NDArray[np.float64]\n   c : NDArray[np.float64]\n\n   _T_x : NDArray[np.float64]\n   _T_y : NDArray[np.float64]\n\n<<Init 2D>>\n\n<<Assemble 2D Matrix>>\n\n   def set_boundary(self , bc=(0.,0. , 0. , 0.)):\n      self.f[ 0,1:-1]= bc[0]\n      self.f[-1,1:-1]= bc[1]\n      self.f[1:-1, 0]= bc[2]\n      self.f[1:-1,-1]= bc[3]\n\n\n   def solve(self):\n      self.c = spsolve(self._A.tocsr() , self.f.ravel()).reshape((self.N,self.M))\n      return self.c\n\n<<2D Microscale Transmissions>>\n`);copyBtnbtn_6c42cf326eb642aaac67423d005cb397.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_6c42cf326eb642aaac67423d005cb397.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> scipy <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">as</span> sp
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> numpy <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">as</span> np
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">class</span> <span style="color: #78DCE8;">FVSolver2D</span>:
<span style="color: #4a9d48074b31;"> </span>  N : <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">int</span>
<span style="color: #4a9d48074b31;"> </span>  M : <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">int</span>
<span style="color: #4a9d48074b31;"> </span>  h_x : np.float64
<span style="color: #4a9d48074b31;"> </span>  h_y : np.float64
<span style="color: #4a9d48074b31;"> </span>  x : NDArray[np.float64]
<span style="color: #4a9d48074b31;"> </span>  y : NDArray[np.float64]
<span style="color: #4a9d48074b31;"> </span>  D : Callable
<span style="color: #4a9d48074b31;"> </span>  f : NDArray[np.float64]
<span style="color: #4a9d48074b31;"> </span>  c : NDArray[np.float64]
 
<span style="color: #4a9d48074b31;"> </span>  _T_x : NDArray[np.float64]
<span style="color: #4a9d48074b31;"> </span>  _T_y : NDArray[np.float64]
 
&lt;&lt;Init 2D&gt;&gt;

&lt;&lt;Assemble 2D Matrix&gt;&gt;
 
<span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">set_boundary</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span> , bc=(0.,0. , 0. , 0.)):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">f</span>[ 0,1:-1]= bc[0]
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">f</span>[-1,1:-1]= bc[1]
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">f</span>[1:-1, 0]= bc[2]
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">f</span>[1:-1,-1]= bc[3]
     
     
<span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">solve</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">c</span> = spsolve(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._A.tocsr() , <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.f.ravel()).reshape((<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N,<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.M))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">return</span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.c
     
&lt;&lt;2D Microscale Transmissions&gt;&gt;
</code></pre>
</div></div>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_92944b2e67d343b4a78482ee1a04ebe3>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_92944b2e67d343b4a78482ee1a04ebe3=document.querySelector('button[name=btn_92944b2e67d343b4a78482ee1a04ebe3]');
copyBtnbtn_92944b2e67d343b4a78482ee1a04ebe3.addEventListener('click', function(event) {
let res = copyTextToClipboard(`   def __init__(self ,\n                N:int,\n                M:int ,\n                D :Callable  ,\n                domain=np.array([[0.,0.] , [1.,1.]]),\n                )->None:\n      self.h_x = (domain[1,0] - domain[0,0]) / N\n      self.h_y = (domain[1,1] - domain[0,1]) / M\n      self.x = np.linspace(domain[0,0] , domain[1,0] , N)\n      self.y = np.linspace(domain[0,1] , domain[1,1] , M)\n      x_h = self.x[:-1] + 0.5 * self.h_x\n      y_h = self.y[:-1] + 0.5 * self.h_y\n      halfgrid_x = np.meshgrid(x_h,self.y,indexing=\"ij\")\n      halfgrid_y = np.meshgrid(self.x,y_h , indexing=\"ij\")\n      self._T_x = -self.h_y/self.h_x * D(halfgrid_x[0] , halfgrid_x[1])\n      self._T_y = -self.h_x/self.h_y * D(halfgrid_y[0] , halfgrid_y[1])\n      self.N = N\n      self.M = M\n      self.D = D\n      self.f = self.h_x * self.h_y* np.ones((N, M))\n\n`);copyBtnbtn_92944b2e67d343b4a78482ee1a04ebe3.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_92944b2e67d343b4a78482ee1a04ebe3.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python" id="org90ccd1e"><code><span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">__init__</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span> ,
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   N:<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">int</span>,
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   M:<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">int</span> ,
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   D :Callable  ,
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   domain=np.array([[0.,0.] , [1.,1.]]),
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   )-&gt;<span style="color: var(--clr-constant); background-color: var(--bg-constant);">None</span>:
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">h_x</span> = (domain[1,0] - domain[0,0]) / N
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">h_y</span> = (domain[1,1] - domain[0,1]) / M
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">x</span> = np.linspace(domain[0,0] , domain[1,0] , N)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">y</span> = np.linspace(domain[0,1] , domain[1,1] , M)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-variable); background-color: var(--bg-variable);">x_h</span> = <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.x[:-1] + 0.5 * <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.h_x
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-variable); background-color: var(--bg-variable);">y_h</span> = <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.y[:-1] + 0.5 * <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.h_y
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-variable); background-color: var(--bg-variable);">halfgrid_x</span> = np.meshgrid(x_h,<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.y,indexing=<span style="color: var(--clr-string); background-color: var(--bg-string);">"ij"</span>)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-variable); background-color: var(--bg-variable);">halfgrid_y</span> = np.meshgrid(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.x,y_h , indexing=<span style="color: var(--clr-string); background-color: var(--bg-string);">"ij"</span>)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">_T_x</span> = -<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.h_y/<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.h_x * D(halfgrid_x[0] , halfgrid_x[1])
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">_T_y</span> = -<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.h_x/<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.h_y * D(halfgrid_y[0] , halfgrid_y[1])
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">N</span> = N
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">M</span> = M
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">D</span> = D
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">f</span> = <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.h_x * <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.h_y* np.ones((N, M))

</code></pre>
</div></div>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_0f8fb2a96939483b9cb6c81bbd5030e8>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_0f8fb2a96939483b9cb6c81bbd5030e8=document.querySelector('button[name=btn_0f8fb2a96939483b9cb6c81bbd5030e8]');
copyBtnbtn_0f8fb2a96939483b9cb6c81bbd5030e8.addEventListener('click', function(event) {
let res = copyTextToClipboard(`   def assemble_matrix(self)->None:\n       main_diag = np.ones((  self.N,self.M))\n       diag_north = np.zeros((self.N,self.M))\n       diag_south = np.zeros((self.N,self.M))\n       diag_east = np.zeros(( self.N,self.M))\n       diag_west = np.zeros(( self.N,self.M))\n       main_diag[1:-1,1:-1] =  -1* (self._T_x[:-1,1:-1] + self._T_x[1:,1:-1] + self._T_y[1:-1,:-1] + self._T_y[1:-1,1:])\n       main_diag = np.ravel(main_diag)\n\n       diag_north[1:-1,1:-1] =  self._T_y[1:-1,:-1]\n       diag_south[1:-1,1:-1] =  self._T_y[1:-1,1:]\n       diag_east[1:-1,1:-1] =   self._T_x[1:,1:-1]\n       diag_west[1:-1,1:-1] =   self._T_x[:-1,1:-1]\n       diag_north = diag_north.ravel()\n       diag_south = diag_south.ravel()\n       diag_west = diag_west.ravel()\n       diag_east = diag_east.ravel()\n\n       A = sp.sparse.spdiags([main_diag , diag_north , diag_south ,  diag_west , diag_east] , [0 , -self.N  , self.N , 1 , -1] , self.N*self.M , self.M*self.N)\n       self._A = A.T\n\n`);copyBtnbtn_0f8fb2a96939483b9cb6c81bbd5030e8.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_0f8fb2a96939483b9cb6c81bbd5030e8.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python" id="orgff9328e"><code><span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">assemble_matrix</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>)-&gt;<span style="color: var(--clr-constant); background-color: var(--bg-constant);">None</span>:
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">main_diag</span> = np.ones((  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N,<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.M))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag_north</span> = np.zeros((<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N,<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.M))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag_south</span> = np.zeros((<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N,<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.M))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag_east</span> = np.zeros(( <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N,<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.M))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag_west</span> = np.zeros(( <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N,<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.M))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">main_diag</span>[1:-1,1:-1] =  -1* (<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_x[:-1,1:-1] + <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_x[1:,1:-1] + <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_y[1:-1,:-1] + <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_y[1:-1,1:])
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">main_diag</span> = np.ravel(main_diag)
     
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag_north</span>[1:-1,1:-1] =  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_y[1:-1,:-1]
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag_south</span>[1:-1,1:-1] =  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_y[1:-1,1:]
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag_east</span>[1:-1,1:-1] =   <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_x[1:,1:-1]
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag_west</span>[1:-1,1:-1] =   <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_x[:-1,1:-1]
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag_north</span> = diag_north.ravel()
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag_south</span> = diag_south.ravel()
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag_west</span> = diag_west.ravel()
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">diag_east</span> = diag_east.ravel()
     
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-variable); background-color: var(--bg-variable);">A</span> = sp.sparse.spdiags([main_diag , diag_north , diag_south ,  diag_west , diag_east] , [0 , -<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N  , <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N , 1 , -1] , <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N*<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.M , <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.M*<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.N)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">_A</span> = A.T

</code></pre>
</div></div>

<p>
on a \(N \times M\) grid
</p>
</div>
<div id="outline-container-org9c8faaf" class="outline-3">
<h3 id="org9c8faaf"><span class="section-number-3">5.1.</span> Numerical Flux in 2D</h3>
<div class="outline-text-3" id="text-5-1">
\begin{align*}
g_{x}(c_{i+1,j} , c_{ij}) &= - \Delta_y D(x_{i+ \frac{1}{2},j }) \frac{c_{i+1,j} - c_{ij}}{\Delta_x}\\
g_y(c_{i,j+1} , c_{ij}) &= - \Delta_x D(x_{i,j+ \frac{1}{2}}) \frac{c_{i,j+1} - c_{ij}}{\Delta_y} \\
g_x(c_{i+1j} , c_{ij}) &=   T^x_{i+1j} \left( c_{i+1j} - c_{ij}  \right)\\
g_y(c_{ij+1} , c_{ij}) &=   T^y_{ij+1} \left( c_{i+1j} - c_{ij}  \right)
\end{align*}
<p>
The boundary term can then be approximated by
</p>
\begin{align*}
 - g_{x}(c_{i,j} , c_{i-1,j}) + g_{x}(c_{i+1,j} , c_{ij})  -  g_y(c_{i,j} , c_{i,j-1}) + g_y(c_{i,j+1} , c_{ij}) &= \Delta_x \Delta_y f(x_{ij})
\end{align*}
<p>
One Dimensionalize the index
</p>
\begin{align*}
 - g_{x}(c_{i + Nj} , c_{i-1 + Nj}) + g_{x}(c_{i+1 + Nj} , c_{i + Nj})  -  g_y(c_{i + Nj} , c_{i + N(j-1)}) + g_y(c_{i + N(j+1)} , c_{i + Nj}) &= \Delta_x \Delta_y f(x_{i + Nj})
\end{align*}
<p>
plug in Flux Approach with \(\Delta_x = \Delta_y = h\)
</p>
\begin{align*}
& \left(D(x-\frac{h}{2},y)c_{i+Nj}-D(x-\frac{h}{2},y)c_{i-1+Nj}\right)\\
&-\left(D(x+\frac{h}{2},y)c_{i+1+Nj}-D(x+\frac{h}{2},y)c_{i+Nj}\right)\\
&+\left(D(x,y-\frac{h}{2})c_{i+Nj}-D(x,y-\frac{h}{2})c_{i+N(j-1)}\right)\\
&-\left(D(x,y+\frac{h}{2})c_{i+N(j+1)}-D(x,y+\frac{h}{2})c_{i+Nj}\right)
\end{align*}

\begin{align*}
& D(x-\frac{h}{2},y)c_{i+Nj}-D(x-\frac{h}{2},y)c_{i-1+Nj}  \\
&-D(x+\frac{h}{2},y)c_{i+1+Nj}+D(x+\frac{h}{2},y)c_{i+Nj}  \\
& D(x,y-\frac{h}{2})c_{i+Nj}-D(x,y-\frac{h}{2})c_{i+N(j-1)}\\
&-D(x,y+\frac{h}{2})c_{i+N(j+1)}+D(x,y+\frac{h}{2})c_{i+Nj}
\end{align*}

\begin{align*}
& -D(x-\frac{h}{2},y)c_{i-1+Nj}  \\
&-D(x+\frac{h}{2},y)c_{i+1+Nj}  \\
& -D(x,y-\frac{h}{2})c_{i+N(j-1)}\\
&-D(x,y+\frac{h}{2})c_{i+N(j+1)}\\
\left(D(x-\frac{h}{2},y) + D(x+\frac{h}{2},y) + D(x,y-\frac{h}{2}) + D(x,y+\frac{h}{2}) \right) c_{i+Nj}
\end{align*}

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_647755795677495da779bfd3f77a4e46>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_647755795677495da779bfd3f77a4e46=document.querySelector('button[name=btn_647755795677495da779bfd3f77a4e46]');
copyBtnbtn_647755795677495da779bfd3f77a4e46.addEventListener('click', function(event) {
let res = copyTextToClipboard(`import os\n\n# Set this before importing NumPy/SciPy\nos.environ[\"OMP_NUM_THREADS\"] = \"16\"       # For MKL/OpenMP\nos.environ[\"OPENBLAS_NUM_THREADS\"] = \"16\"  # For OpenBLAS\nos.environ[\"MKL_NUM_THREADS\"] = \"16\"       # For Intel MKL\nos.environ[\"NUMEXPR_NUM_THREADS\"] = \"16\"   # Just in case\n\nimport numpy as np\nimport scipy\n\n`);copyBtnbtn_647755795677495da779bfd3f77a4e46.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_647755795677495da779bfd3f77a4e46.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> os

<span style="color: var(--clr-comment-delimiter); background-color: var(--bg-comment-delimiter);"># </span><span style="color: var(--clr-comment); background-color: var(--bg-comment);">Set this before importing NumPy/SciPy</span>
os.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">environ</span>[<span style="color: var(--clr-string); background-color: var(--bg-string);">"OMP_NUM_THREADS"</span>] = <span style="color: var(--clr-string); background-color: var(--bg-string);">"16"</span>       <span style="color: var(--clr-comment-delimiter); background-color: var(--bg-comment-delimiter);"># </span><span style="color: var(--clr-comment); background-color: var(--bg-comment);">For MKL/OpenMP</span>
os.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">environ</span>[<span style="color: var(--clr-string); background-color: var(--bg-string);">"OPENBLAS_NUM_THREADS"</span>] = <span style="color: var(--clr-string); background-color: var(--bg-string);">"16"</span>  <span style="color: var(--clr-comment-delimiter); background-color: var(--bg-comment-delimiter);"># </span><span style="color: var(--clr-comment); background-color: var(--bg-comment);">For OpenBLAS</span>
os.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">environ</span>[<span style="color: var(--clr-string); background-color: var(--bg-string);">"MKL_NUM_THREADS"</span>] = <span style="color: var(--clr-string); background-color: var(--bg-string);">"16"</span>       <span style="color: var(--clr-comment-delimiter); background-color: var(--bg-comment-delimiter);"># </span><span style="color: var(--clr-comment); background-color: var(--bg-comment);">For Intel MKL</span>
os.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">environ</span>[<span style="color: var(--clr-string); background-color: var(--bg-string);">"NUMEXPR_NUM_THREADS"</span>] = <span style="color: var(--clr-string); background-color: var(--bg-string);">"16"</span>   <span style="color: var(--clr-comment-delimiter); background-color: var(--bg-comment-delimiter);"># </span><span style="color: var(--clr-comment); background-color: var(--bg-comment);">Just in case</span>

<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> numpy <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">as</span> np
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> scipy

</code></pre>
</div></div>

<pre class="example">
None
</pre>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_08743b9cb4974d6e929bee0726ec49e3>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_08743b9cb4974d6e929bee0726ec49e3=document.querySelector('button[name=btn_08743b9cb4974d6e929bee0726ec49e3]');
copyBtnbtn_08743b9cb4974d6e929bee0726ec49e3.addEventListener('click', function(event) {
let res = copyTextToClipboard(`import seaborn as sns\nimport matplotlib.pyplot as plt\nimport numpy as np\n`);copyBtnbtn_08743b9cb4974d6e929bee0726ec49e3.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_08743b9cb4974d6e929bee0726ec49e3.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> seaborn <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">as</span> sns
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> matplotlib.pyplot <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">as</span> plt
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> numpy <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">as</span> np
</code></pre>
</div></div>


<div id="orgae81c33" class="figure">
<p><img src="images/2D_Diffusion.png" alt="2D_Diffusion.png" />
</p>
</div>


<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_4d99b2fa67c2434c8fc35684e3b73247>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_4d99b2fa67c2434c8fc35684e3b73247=document.querySelector('button[name=btn_4d99b2fa67c2434c8fc35684e3b73247]');
copyBtnbtn_4d99b2fa67c2434c8fc35684e3b73247.addEventListener('click', function(event) {
let res = copyTextToClipboard(`reload(src.fvsolver)\nfrom src.fvsolver import FVSolver2D\nsmol_fv = FVSolver2D(10,10,D)\nsmol_fv.assemble_matrix()\nplt.imshow(smol_fv._A.todense())\n#plt.spy(A.T, markersize=1)\n`);copyBtnbtn_4d99b2fa67c2434c8fc35684e3b73247.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_4d99b2fa67c2434c8fc35684e3b73247.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">reload</span>(src.fvsolver)
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">from</span> src.fvsolver <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> FVSolver2D
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">smol_fv</span> = FVSolver2D(10,10,D)
smol_fv.assemble_matrix()
plt.imshow(smol_fv._A.todense())
<span style="color: var(--clr-comment-delimiter); background-color: var(--bg-comment-delimiter);">#</span><span style="color: var(--clr-comment); background-color: var(--bg-comment);">plt.spy(A.T, markersize=1)</span>
</code></pre>
</div></div>


<div id="org62d8e1d" class="figure">
<p><img src="images/spy.svg" alt="spy.svg" class="org-svg" />
</p>
</div>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_22fcc33719a440fd931d96ae1be1ef23>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_22fcc33719a440fd931d96ae1be1ef23=document.querySelector('button[name=btn_22fcc33719a440fd931d96ae1be1ef23]');
copyBtnbtn_22fcc33719a440fd931d96ae1be1ef23.addEventListener('click', function(event) {
let res = copyTextToClipboard(`fv2D = FVSolver2D(N,M,D)\nsns.heatmap(fv2D._T_y, cmap=\"magma\")\n`);copyBtnbtn_22fcc33719a440fd931d96ae1be1ef23.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_22fcc33719a440fd931d96ae1be1ef23.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-variable); background-color: var(--bg-variable);">fv2D</span> = FVSolver2D(N,M,D)
sns.heatmap(fv2D._T_y, cmap=<span style="color: var(--clr-string); background-color: var(--bg-string);">"magma"</span>)
</code></pre>
</div></div>


<div id="org822be80" class="figure">
<p><img src="images/_T_x.png" alt="_T_x.png" />
</p>
</div>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_523297d81c7f449d9c6dd99456926786>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_523297d81c7f449d9c6dd99456926786=document.querySelector('button[name=btn_523297d81c7f449d9c6dd99456926786]');
copyBtnbtn_523297d81c7f449d9c6dd99456926786.addEventListener('click', function(event) {
let res = copyTextToClipboard(`fv2D = FVSolver2D(N,M,D)\nfv2D.assemble_matrix()\nfv2D.set_boundary()\nc = fv2D.solve()\nsns.heatmap(c, cmap=\"magma\")\n`);copyBtnbtn_523297d81c7f449d9c6dd99456926786.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_523297d81c7f449d9c6dd99456926786.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-variable); background-color: var(--bg-variable);">fv2D</span> = FVSolver2D(N,M,D)
fv2D.assemble_matrix()
fv2D.set_boundary()
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">c</span> = fv2D.solve()
sns.heatmap(c, cmap=<span style="color: var(--clr-string); background-color: var(--bg-string);">"magma"</span>)
</code></pre>
</div></div>


<div id="org7752ecd" class="figure">
<p><img src="images/2d-result.png" alt="2d-result.png" />
</p>
</div>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_06c34601a6b84f91b09c25b47666083b>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_06c34601a6b84f91b09c25b47666083b=document.querySelector('button[name=btn_06c34601a6b84f91b09c25b47666083b]');
copyBtnbtn_06c34601a6b84f91b09c25b47666083b.addEventListener('click', function(event) {
let res = copyTextToClipboard(`error =np.linalg.norm(A@c_vec - f)\nprint(error)\n`);copyBtnbtn_06c34601a6b84f91b09c25b47666083b.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_06c34601a6b84f91b09c25b47666083b.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-variable); background-color: var(--bg-variable);">error</span> =np.linalg.norm(A@c_vec - f)
<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">print</span>(error)
</code></pre>
</div></div>

<pre class="example">
1.025105313314805e-12
</pre>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_ac8ec76f191048708a95ac3407e87ae2>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_ac8ec76f191048708a95ac3407e87ae2=document.querySelector('button[name=btn_ac8ec76f191048708a95ac3407e87ae2]');
copyBtnbtn_ac8ec76f191048708a95ac3407e87ae2.addEventListener('click', function(event) {
let res = copyTextToClipboard(`fig = plt.figure()\nax = fig.add_subplot(111, projection='3d')\nax.plot_surface(grid[0] ,grid[1],c , cmap=\"magma\")\n`);copyBtnbtn_ac8ec76f191048708a95ac3407e87ae2.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_ac8ec76f191048708a95ac3407e87ae2.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-variable); background-color: var(--bg-variable);">fig</span> = plt.figure()
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">ax</span> = fig.add_subplot(111, projection=<span style="color: var(--clr-string); background-color: var(--bg-string);">'3d'</span>)
ax.plot_surface(grid[0] ,grid[1],c , cmap=<span style="color: var(--clr-string); background-color: var(--bg-string);">"magma"</span>)
</code></pre>
</div></div>


<div id="orgf6778b1" class="figure">
<p><img src="images/2d-surf.png" alt="2d-surf.png" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org726fc78" class="outline-2">
<h2 id="org726fc78"><span class="section-number-2">6.</span> 2D Multiscale</h2>
<div class="outline-text-2" id="text-6">
<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_5eab32f7ce0346a6ba215264a4c44c98>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_5eab32f7ce0346a6ba215264a4c44c98=document.querySelector('button[name=btn_5eab32f7ce0346a6ba215264a4c44c98]');
copyBtnbtn_5eab32f7ce0346a6ba215264a4c44c98.addEventListener('click', function(event) {
let res = copyTextToClipboard(`   def set_multiscale_transmissions(self, resolution):\n      microscale_basis_x = np.zeros((self._T_x.shape[0] , self._T_x.shape[1] , resolution))\n      microscale_basis_y = np.zeros((self._T_y.shape[0] , self._T_y.shape[1] , resolution))\n      for i in range(self._T_x.shape[0]):\n         for j in range(self._T_x.shape[1]):\n            #Do mircroscale x\n            D_micro = lambda x: self.D(x, self.y[j])\n            fv_micro = FVSolver(resolution , D_micro, domain=(self.x[i] , self.x[i+1]))\n            fv_micro.assemble_matrix()\n            fv_micro.set_boundary(bc=(0.,1.))\n            phi =fv_micro.solve()\n            microscale_basis_x[i,j,:] = phi\n            self._T_x[i,j] =   -fv_micro.h * self.h_y* np.sum(((phi[1:] - phi[:-1])/fv_micro.h)**2 * D_micro(fv_micro.x[:-1]))\n\n      for i in range(self._T_y.shape[0]):\n         for j in range(self._T_y.shape[1]):\n            # Do microscale y\n            D_micro = lambda y: self.D(self.x[i], y)\n            fv_micro = FVSolver(resolution , D_micro, domain=(self.y[j] , self.y[j+1]))\n            fv_micro.assemble_matrix()\n            fv_micro.set_boundary(bc=(0.,1.))\n            phi =fv_micro.solve()\n            microscale_basis_y[i,j,:] = phi\n            self._T_y[i,j] =   -fv_micro.h * self.h_x  * np.sum(((phi[1:] - phi[:-1])/fv_micro.h)**2 * D_micro(fv_micro.x[:-1]))\n\n      return microscale_basis_x , microscale_basis_y\n\n`);copyBtnbtn_5eab32f7ce0346a6ba215264a4c44c98.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_5eab32f7ce0346a6ba215264a4c44c98.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python" id="org12f68cb"><code><span style="color: #4a9d48074b31;"> </span>  <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">def</span> <span style="color: var(--function-clr-name); background-color: var(--function-bg-name);">set_multiscale_transmissions</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>, resolution):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-variable); background-color: var(--bg-variable);">microscale_basis_x</span> = np.zeros((<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_x.shape[0] , <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_x.shape[1] , resolution))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-variable); background-color: var(--bg-variable);">microscale_basis_y</span> = np.zeros((<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_y.shape[0] , <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_y.shape[1] , resolution))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">for</span> i <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">in</span> <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">range</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_x.shape[0]):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">for</span> j <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">in</span> <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">range</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_x.shape[1]):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-comment-delimiter); background-color: var(--bg-comment-delimiter);">#</span><span style="color: var(--clr-comment); background-color: var(--bg-comment);">Do mircroscale x</span>
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">D_micro</span> = <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">lambda</span> x: <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.D(x, <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.y[j])
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">fv_micro</span> = FVSolver(resolution , D_micro, domain=(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.x[i] , <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.x[i+1]))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   fv_micro.assemble_matrix()
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   fv_micro.set_boundary(bc=(0.,1.))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">phi</span> =fv_micro.solve()
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">microscale_basis_x</span>[i,j,:] = phi
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">_T_x</span>[<span style="color: var(--clr-variable); background-color: var(--bg-variable);">i</span>,<span style="color: var(--clr-variable); background-color: var(--bg-variable);">j</span>] =   -fv_micro.h * <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.h_y* np.<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">sum</span>(((phi[1:] - phi[:-1])/fv_micro.h)**2 * D_micro(fv_micro.x[:-1]))
         
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">for</span> i <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">in</span> <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">range</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_y.shape[0]):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span><span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">for</span> j <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">in</span> <span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">range</span>(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>._T_y.shape[1]):
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-comment-delimiter); background-color: var(--bg-comment-delimiter);"># </span><span style="color: var(--clr-comment); background-color: var(--bg-comment);">Do microscale y</span>
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">D_micro</span> = <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">lambda</span> y: <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.D(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.x[i], y)
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">fv_micro</span> = FVSolver(resolution , D_micro, domain=(<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.y[j] , <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.y[j+1]))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   fv_micro.assemble_matrix()
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   fv_micro.set_boundary(bc=(0.,1.))
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">phi</span> =fv_micro.solve()
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-variable); background-color: var(--bg-variable);">microscale_basis_y</span>[i,j,:] = phi
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span>   <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.<span style="color: var(--clr-variable); background-color: var(--bg-variable);">_T_y</span>[<span style="color: var(--clr-variable); background-color: var(--bg-variable);">i</span>,<span style="color: var(--clr-variable); background-color: var(--bg-variable);">j</span>] =   -fv_micro.h * <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">self</span>.h_x  * np.<span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">sum</span>(((phi[1:] - phi[:-1])/fv_micro.h)**2 * D_micro(fv_micro.x[:-1]))
         
<span style="color: #4a9d48074b31;"> </span>   <span style="color: #4a9d48074b31;"> </span> <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">return</span> microscale_basis_x , microscale_basis_y

</code></pre>
</div></div>

<div class='org-src-wrapper'>
<div class='org-src-bar'><span class='srcLangLabel'>PYTHON</span><button class='copyBtn' name=btn_09e57976553b4755b3f14368e5b3f6d3>&#10697;</button>
<script type='text/javascript'>
var copyBtnbtn_09e57976553b4755b3f14368e5b3f6d3=document.querySelector('button[name=btn_09e57976553b4755b3f14368e5b3f6d3]');
copyBtnbtn_09e57976553b4755b3f14368e5b3f6d3.addEventListener('click', function(event) {
let res = copyTextToClipboard(`reload(src.fvsolver)\nfrom src.fvsolver import FVSolver2D\nfv2D = FVSolver2D(100,100,D)\nmx,my = fv2D.set_multiscale_transmissions(100)\nfv2D.assemble_matrix()\nfv2D.set_boundary()\nc = fv2D.solve()\nsns.heatmap(c, cmap=\"magma\")\n`);copyBtnbtn_09e57976553b4755b3f14368e5b3f6d3.innerHTML = res ? '&#10003;' : 'error';setTimeout(() => { copyBtnbtn_09e57976553b4755b3f14368e5b3f6d3.innerHTML = '&#10697;'}, 3000);
});
</script>
</div><div class="org-src-container">
<pre class="src src-python"><code><span style="color: var(--clr-builtin); background-color: var(--bg-builtin);">reload</span>(src.fvsolver)
<span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">from</span> src.fvsolver <span style="color: var(--clr-keyword); background-color: var(--bg-keyword);">import</span> FVSolver2D
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">fv2D</span> = FVSolver2D(100,100,D)
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">mx</span>,<span style="color: var(--clr-variable); background-color: var(--bg-variable);">my</span> = fv2D.set_multiscale_transmissions(100)
fv2D.assemble_matrix()
fv2D.set_boundary()
<span style="color: var(--clr-variable); background-color: var(--bg-variable);">c</span> = fv2D.solve()
sns.heatmap(c, cmap=<span style="color: var(--clr-string); background-color: var(--bg-string);">"magma"</span>)
</code></pre>
</div></div>


<div id="org397b1c7" class="figure">
<p><img src="images/2d-multi-result.png" alt="2d-multi-result.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-org255a6ec" class="outline-2">
<h2 id="org255a6ec"><span class="section-number-2">7.</span> Reference Solution</h2>
<div class="outline-text-2" id="text-7">
<p>
Solution of the 2D Laplace equation:
</p>
\begin{align}
\label{eq:poisson}
- \Delta u(x,y) &= f(x,y) & \text{in} \quad \Omega \\
u(x,y) &= 0 & \text{on} \quad  \Gamma_D
\end{align}
<p>
where \(f(x,y) = 2 * (x+y - x^2 - y^2) \) the analytical solution is
</p>
\begin{align*}
u(x,y) &= x * (1-x) * y * (1-y)
\end{align*}
</div>
</div>
</div>
<div id="postamble" class="status">
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
if (!document.cookie.split('; ').find(r => r.startsWith('mode'))) {
document.cookie = 'mode=dark'
}
document.cookie = 'light=doom-plain'
document.cookie = 'dark=doom-tomorrow-night'
/*
;; nice-org-html.js
;;==============================================================================
;; Copyright (C) 2024, Ewan Townshend

;; Author: Ewan Townshend
;; URL: https://github.com/ewantown/nice-org-html
;; Version: 1.2

;;==============================================================================
;; This program is free software; you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation, either version 3 of the License, or
;; (at your option) any later version.

;; This program is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.

;; You should have received a copy of the GNU General Public License
;; along with this program.  If not, see <https://www.gnu.org/licenses/>.

;; This file is not part of emacs.

;;==============================================================================
;; JS for html exported by et-org-html.el
 */

const preamble = document.getElementById("preamble");
const content = document.getElementById("content");
const postamble = document.getElementById("postamble");

const controls = document.getElementById("view-controls");
const toggleTocBtn = document.getElementById("toggle-toc");
const gotoTopBtn = document.getElementById("goto-top");
const toggleModeBtn = document.getElementById("toggle-mode");
const toc = document.getElementById("table-of-contents");

// Get and parse options passed in cookie string
const optCookie = document.cookie.split('; ').find(r => r.startsWith('options'));
const options = {};
if (optCookie) {
  optCookie.split('=')[1].split('__').forEach(pair => {
    const [key, val] = pair.split(':');
    if (key && val) {
      options[key] = val;
    }
  })
}

// Move sticky control bar (injected within preamble)
document.body.insertBefore(controls, content);

// Mode handling
function getMode() {
  let cookie = document.cookie.split('; ').find(r => r.startsWith('mode'))
  return cookie && cookie.split("=")[1];
}

function setMode(mode) {
  document.body.dataset.mode = mode;
  let thmCookie = document.cookie.split('; ').find(r => r.startsWith(mode));
  document.body.dataset.theme = thmCookie ? thmCookie.split('=')[1] : 'unknown';
  toggleModeBtn.innerHTML = (mode === 'light') ? '&#9789;' : '&#9788;';
  document.cookie = 'mode=' + mode;
}

// Initially, set mode based on stored cookie
let mode = getMode();
if (mode && ["light", "dark"].includes(mode)) {
  setMode(mode);
} else {  
  let prop = "prefers-color-scheme";
  let pref = (mode === "query") && window.matchMedia &&
    ["light", "dark"].find(s => window.matchMedia(`(${prop}: ${s})`).matches);
  setMode(pref || "dark"); // fallback: dark
}

// Mode toggling
toggleModeBtn.addEventListener('click', () => {
  setMode(document.body.dataset.mode === 'dark' ? 'light' : 'dark');
})


// Jump to top
let scrollY = document.documentElement.scrollTop;
window.addEventListener('scroll', () => {
  let atTop = document.documentElement.scrollTop <= preamble.offsetHeight;
  gotoTopBtn.dataset.show = !atTop + "";
});
gotoTopBtn.addEventListener('click', () => {
  window.scrollTo({
    top: 0,
    behavior: "smooth"
  });
})

// Table-of-contents toggling
if (toc) {
  toggleTocBtn.dataset.show = 'true';
  toggleTocBtn.addEventListener('click', () => {
    let showingToc = document.body.dataset.toc;
    scrollY = showingToc ? scrollY : document.documentElement.scrollTop;
    if (showingToc) {
      document.body.dataset.toc = '';
      document.documentElement.scrollTop = scrollY;
    } else {
      let tocHeight =
	Math.max(
	  window.innerHeight - controls.offsetHeight,
	  toc.offsetHeight
	);
      const header = document.getElementById("injected-header");
      if (header && (scrollY > header.offsetHeight)) {
	document.documentElement.scrollTop = preamble.offsetHeight;
      }
      toc.style.height = `${tocHeight}px`;
      document.body.dataset.toc = 'true';
    }
    toc.addEventListener('click', () => {
      if (document.body.dataset.toc) {
	document.body.dataset.toc = '';
	document.documentElement.scrollTop = scrollY;
      }
    })
  })
};

// Instrument anchor linking for sticky control bar
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', (e) => {
    e.preventDefault();
    const targetId = e.currentTarget.getAttribute('href');
    const target = document.querySelector(targetId);

    setTimeout(() => {
      const targetPos = target.getBoundingClientRect().top;
      let offset = targetPos + document.documentElement.scrollTop;
      offset -= controls.offsetHeight;
      window.scrollTo({
	top: offset,
	behavior: "smooth"
      });
    }, 0);
  });
});

function copyTextToClipboard(text) {
  // Make invisible textarea
  var textArea = document.createElement("textarea");
  textArea.style.position = 'fixed';
  textArea.style.top = 0;
  textArea.style.left = 0;
  textArea.style.width = '2em';
  textArea.style.height = '2em';
  textArea.style.padding = 0;
  textArea.style.border = 'none';
  textArea.style.outline = 'none';
  textArea.style.boxShadow = 'none';
  textArea.style.background = 'transparent';

  // Copy contents into it
  textArea.value = text;

  // Try to copy from it to clipboard
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  var res;
  try {
    res = document.execCommand('copy');
  } catch (err) {
    res = false;
  }

  // Remove invisible textarea
  document.body.removeChild(textArea);

  return res;
}

// Handle the default header / footer drawers
const header = document.getElementById("generated-header");
const footer = document.getElementById("generated-footer");

if (header) {
  let toggle = header.querySelector("header nav input.nav-toggle");
  if (toggle) { toggle.checked = false; }
}
if (footer) {
  let nav = footer.querySelector("nav");
  let toggle = nav && nav.querySelector(".nav-toggle");
  let navList = nav && nav.querySelector(".nav-list");
  let navElem = navList && [...navList.querySelectorAll(".nav-item")];
  let numLink = navElem && navElem.length;
  if (numLink) {
    toggle.checked = false;
    toggle.addEventListener('change', () => {
      if (toggle.checked) {
	setTimeout(() => window.scrollTo({
	  behavior: 'smooth',
	  top: document.body.scrollHeight	  
	}), 88);
      }
   });
  }
}

function autoCompact() {
  var anchor, links, overlap, trivial;
  const domCompute = (node) => {
    if (node) {
      anchor = node.querySelector('.nav-title, .nav-author');
      links = node.querySelector('.nav-list');
      overlap = links.offsetLeft - 5 <= anchor.offsetLeft + anchor.offsetWidth;	
      trivial = links.offsetLeft === anchor.offsetLeft;
    }
  };
  let mediaMatch = window.matchMedia('(max-width: 768px)').matches;
  [header, footer].forEach(e => {
    if (e) {
      if (mediaMatch) {
	e.classList.add('compact');
      } else {
	domCompute(e);
	if (overlap && !trivial) {
	  e.classList.add('compact');
	} else {	
	  let clone = e.cloneNode(true);
	  clone.style.top = '-2000px';
	  clone.style.maxHeight = '0px';
	  clone.classList.remove('compact');
	  e.parentNode.insertBefore(clone, e);
	  domCompute(clone);
	  let toggle = e.querySelector('.nav-toggle');
	  if (!overlap && toggle && !toggle.checked) {
	    e.classList.remove('compact');
	  }
	  e.parentNode.removeChild(clone);
	}
      }
    }
  })
}

if ((header || footer)) {
  if (options.hasOwnProperty('layout')) {
    [header, footer].forEach(e => e ? e.classList.add(options.layout) : null);
  } else {
    autoCompact();
    window.addEventListener('resize', autoCompact);
  }
}

if (options.hasOwnProperty('src-lang') && options['src-lang'] == 't') {
  let labels = [...document.querySelectorAll('.srcLangLabel')];
  labels.forEach(l => l.style.display = 'inline-block');
}

if (options.hasOwnProperty('collapsing') && options.collapsing == 't') {
  let levels = [2, 3, 4, 5, 6];
  let containerPrefix = 'outline-container-';
  levels.forEach(l => {
    let containers = [...document.querySelectorAll(`.outline-${l}`)];
    containers.forEach(c => {
      let id = c.id.slice(containerPrefix.length);
      let headline = document.getElementById(id);
      let siblings = [...c.children].filter(child => child.id != id);
      headline.classList.add('collapsible');
      headline.addEventListener('click', () => {	
	if (headline.classList.contains('collapsed')) {
	  headline.classList.remove('collapsed');
	  siblings.forEach(child => {
	    child.classList.remove('hidden');
	  });	  
	} else {
	  headline.classList.add('collapsed');
	  siblings.forEach(child => {
	    child.classList.add('hidden');
	  });
	}
      })
    })
  })
}
/*]]>*/-->
</script><div hidden>Generated by: https://github.com/ewantown/nice-org-html</div>
</div>
</body>
</html>
